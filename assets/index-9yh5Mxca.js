var S=Object.defineProperty;var j=(u,e,n)=>e in u?S(u,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[e]=n;var y=(u,e,n)=>j(u,typeof e!="symbol"?e+"":e,n);import{e as x,f as R,m as O,d as L,c as w,a as b,u as _,F as P,r as D,s as W,o as v,g as M,t as F,w as B,_ as A,b as N}from"./styles-dOjvTARq.js";import{I as T,a as H,F as z,C as V}from"./folder-BuCtMlhz.js";var $={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};function U(u){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},o=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),o.forEach(function(l){q(u,l,n[l])})}return u}function q(u,e,n){return e in u?Object.defineProperty(u,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):u[e]=n,u}var k=function(e,n){var o=U({},e,n.attrs);return x(T,U({},o,{icon:$}),null)};k.displayName="DeleteOutlined";k.inheritAttrs=!1;const G=[".png",".jpg",".jpeg"],X=new Map([["bathtub",2],["bed",2],["candelabra",2],["candle",2],["chair",2],["chandelier",2],["door",2],["doorclosed",3],["lamp",2],["lantern",2],["toilet",2],["clock",1]]);class J{constructor(e,n=[]){y(this,"files",R([]));y(this,"validPostfix");y(this,"processing",!1);this.folder=e,this.validPostfix=new Set(G.concat(n)),e.on("update",()=>{this.files.splice(0),e.folders.forEach(o=>this.readFolder(o))})}async readFolder(e){for await(const n of e.values())n.kind!=="directory"&&this.checkPostfix(n)&&this.files.push({handle:O(n),folder:O(e),checked:!0})}checkPostfix(e){var f;const o=e.name.split(".");if(o.length===1||o.length===0)return!1;const l="."+o.at(-1);return this.validPostfix.has(l)&&!((f=o.at(-2))!=null&&f.endsWith("_Highlight"))}async generate(){this.processing||(this.processing=!0,H.info("处理中，请稍后..."),await Promise.all([...this.files].map(async({handle:e,folder:n,checked:o})=>{if(!o)return;const f=await(await e.getFile()).arrayBuffer(),i=await this.handleImage(f,e.name),a=await new Promise(h=>{i.toBlob(g=>{h(g)})});if(!a)return;const s=e.name.split("."),c=s.slice(0,-1).join(".")+"_Highlight."+s.at(-1),t=await(await n.getFileHandle(c,{create:!0})).createWritable();await t.write(a),await t.close()})),H.success("保存成功！"),this.processing=!1)}async handleImage(e,n){var p;const o=new Blob([e],{type:"image/png"}),l=URL.createObjectURL(o),f=new Image;f.src=l,await new Promise(m=>{f.addEventListener("load",()=>m(),{once:!0})});const i=document.createElement("canvas"),a=i.getContext("2d");i.width=f.width,i.height=f.height;const s=(p=n.split(".").at(-2))==null?void 0:p.toLowerCase(),c=[...X].find(([m])=>s==null?void 0:s.endsWith(m));let d=1;c&&(d=c[1]);const t=!!(s!=null&&s.endsWith("chest")),h=this.eliminateInterval(f,d,t),g=[];return h.forEach(([m,I])=>{g.push(this.checkEdges(m,I))}),this.recoverInterval(a,g,t),URL.revokeObjectURL(l),i}eliminateInterval(e,n,o){const l=Math.ceil(e.width/18),f=Math.ceil(e.height/18),i=Math.round(l/n),a=[];if(o){const r=Math.ceil(l/2),s=Math.ceil(f/2);for(let c=0;c<r;c++)for(let d=0;d<s;d++){const t=document.createElement("canvas"),h=t.getContext("2d");t.width=17,t.height=17,h.imageSmoothingEnabled=!1;const g=c*36,p=d*38;h.drawImage(e,g,p,16,16,0,0,8,8),h.drawImage(e,g+18,p,16,16,8,0,8,8),h.drawImage(e,g,p+18,16,18,0,8,8,9),h.drawImage(e,g+18,p+18,16,18,8,8,8,9),a.push([t,h])}}else for(let r=0;r<n;r++){const s=document.createElement("canvas"),c=s.getContext("2d");s.width=i*8,s.height=f*8,c.imageSmoothingEnabled=!1;for(let d=0;d<i;d++)for(let t=0;t<f;t++){const h=r*i*18+d*18,g=t*18,p=d*8,m=t*8;c.drawImage(e,h,g,16,16,p,m,8,8)}a.push([s,c])}return a}recoverInterval(e,n,o){const l=Math.round(n[0].width/8),f=Math.round(n[0].height/8);if(e.imageSmoothingEnabled=!1,o){const i=Math.ceil(e.canvas.width/18/2),a=Math.ceil(e.canvas.height/18/2);for(let r=0;r<i;r++)for(let s=0;s<a;s++){const c=s+r*a,d=r*36,t=s*38,h=n[c];e.drawImage(h,0,0,8,8,d,t,16,16),e.drawImage(h,8,0,8,8,d+18,t,16,16),e.drawImage(h,0,8,8,9,d,t+18,16,18),e.drawImage(h,8,8,8,9,d+18,t+18,16,18)}}else n.forEach((i,a)=>{for(let r=0;r<l;r++)for(let s=0;s<f;s++){const c=r*8,d=s*8,t=l*a*18+r*18,h=s*18;e.drawImage(i,c,d,8,8,t,h,16,16)}})}checkEdges(e,n){const o=document.createElement("canvas"),l=o.getContext("2d");o.width=e.width,o.height=e.height;const i=n.getImageData(0,0,e.width,e.height).data,a=new Uint8ClampedArray(i.length),r=t=>{a[t*4]=255,a[t*4+1]=255,a[t*4+2]=255,a[t*4+3]=255},s=[];for(let t=0;t<e.width;t++)s.push(t,e.width*(e.height-1)+t);for(let t=1;t<e.height-1;t++)s.push(t*e.width,t*e.width+e.width-1);const c=new Set;for(;s.length>0;){const t=s.shift();if(t===void 0||c.has(t))continue;if(i[t*4+3]<25){const g=t%e.width,p=Math.floor(t/e.width),m=(p-1)*e.width+g,I=(p+1)*e.width+g,C=t-1,E=t+1;c.has(m)||s.push(m),c.has(I)||s.push(I),c.has(C)||s.push(C),c.has(E)||s.push(E)}else r(t);c.add(t)}c.clear();const d=new ImageData(a,e.width,e.height);return l.clearRect(0,0,e.width,e.height),l.putImageData(d,0,0),o}}const Q={class:"tool-main"},Y={key:0,class:"tool-split"},Z={class:"tool-left"},K={class:"folder-list"},ee={class:"folder-one"},te={class:"tool-right"},ne={class:"image-item"},se={key:1,class:"not-support"},oe=L({__name:"App",setup(u){const e="showDirectoryPicker"in window,n=W([]),o=new z,l=new J(o);return o.on("update",()=>{n.value=[...o.folders]}),(f,i)=>(v(),w("div",Q,[e?(v(),w("div",Y,[b("div",Z,[b("div",{class:"button",onClick:i[0]||(i[0]=a=>_(o).choose())}," 选择并添加文件夹 "),b("div",K,[(v(!0),w(P,null,D(n.value,a=>(v(),w("div",ee,[M(F(a.name)+" ",1),x(_(k),{class:"folder-delete"})]))),256))]),b("div",{class:"button",onClick:i[1]||(i[1]=a=>_(l).generate())},"生成描边"),i[2]||(i[2]=b("div",null,"注意，该工具只会读取一层文件夹的图片",-1))]),b("div",te,[(v(!0),w(P,null,D(_(l).files,a=>(v(),w("div",ne,[x(_(V),{checked:a.checked,"onUpdate:checked":r=>a.checked=r},{default:B(()=>[M(F(a.handle.name),1)]),_:2},1032,["checked","onUpdate:checked"])]))),256))])])):(v(),w("div",se," 你的浏览器不支持本工具，请更新浏览器。 "))]))}}),ae=A(oe,[["__scopeId","data-v-54b83fc8"]]);N(ae).mount("#app");
